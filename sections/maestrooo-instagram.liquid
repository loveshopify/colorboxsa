{%- comment -%}
This section code has been generated by Maestrooo's Instagram app. Make sure to not edit the code unless you know
what you are doing, as you may break the app.
{%- endcomment -%}

{%- comment -%}Image count is calculated based on the selected settings{%- endcomment -%}

{%- case section.settings.layout -%}
  {%- when 'grid' -%}
    {%- if section.settings.image_size == 'small' -%}
      {%- assign image_count = 6 | times: section.settings.rows_count -%}
    {%- elsif section.settings.image_size == 'medium' -%}
      {%- assign image_count = 5 | times: section.settings.rows_count -%}
    {%- else -%}
      {%- assign image_count = 4 | times: section.settings.rows_count -%}
    {%- endif -%}
  {%- when 'collage' -%}
    {%- if section.settings.image_size == 'small' -%}
      {%- assign image_count = 9 -%}
    {%- elsif section.settings.image_size == 'medium' -%}
      {%- assign image_count = 7 -%}
    {%- else -%}
      {%- assign image_count = 5 -%}
    {%- endif -%}
  {%- when 'sliding_carousel' -%}
    {%- assign image_count = 15 -%}
{%- endcase -%}

{%- capture section_settings -%}
{
  "feed": "default",
  "locale": {{ request.locale.iso_code | json }},
  "layout": {{ section.settings.layout | json }},
  "imageSize": {{ section.settings.image_size | json }},
  "imageCount": {{ image_count | json }},
  "showAuthor": {{ section.settings.show_author | json }},
  "showCaption": {{ section.settings.show_caption | json }},
  "showDate": {{ section.settings.show_date | json }},
  "clickAction": {{ section.settings.click_action | json }}
}
{%- endcapture -%}

<section class="ooo-instagram" data-section-id="{{ section.id }}" data-section-type="app-section-feed" data-section-settings='{{ section_settings }}'>
  <div class="ooo-instagram-container">
    {%- if section.settings.title != blank or section.settings.subheading != blank -%}
      <header class="ooo-instagram-header">
        {%- if section.settings.title != blank -%}
          <h2 class="ooo-instagram-header__title">{{ section.settings.title }}</h2>
        {%- endif -%}

        {%- if section.settings.subheading != blank -%}
          <div class="ooo-instagram-header__subheading">
            {{- section.settings.subheading -}}
          </div>
        {%- endif -%}
      </header>
    {%- endif -%}

    <div class="ooo-instagram-feed">
      {%- comment -%}
      NOTE: the following code is used to generate the template for images, that will be filled dynamically in JavaScript. You
            can alter the code, but you need to make sure to keep the various data attributes that are used by the JavaScript code
            to fill the data. You need to make sure that the template tag contains the "data-media-template" attribute
      {%- endcomment -%}

      <div class="ooo-instagram-feed__list">
        <template data-media-template>
          {%- capture instagram_media_content -%}
            <img class="ooo-instagram-media__image" src="" loading="lazy" height="400" width="400" alt="" data-instagram-field="media_url">

            {%- capture overlay_content -%}
              {%- if section.settings.show_author -%}
                <p class="ooo-instagram-media__author-container">
                  <svg width="10" height="12" class="ooo-instagram-media__author-icon">
                    <path d="M5 7c3.375 0 5 2.106 5 3.333V11a1 1 0 01-1 1H1a1 1 0 01-1-1v-.667C0 9.106 1.625 7 5 7zm0-7a3 3 0 110 6 3 3 0 010-6z" fill="{{ section.settings.overlay_text_color }}" fill-rule="nonzero"/>
                  </svg>

                  <span class="ooo-instagram-media__author" data-instagram-field="username"></span>
                </p>
              {%- endif -%}

              {%- if section.settings.show_caption -%}
                <p class="ooo-instagram-media__caption" data-instagram-field="caption"></p>
              {%- endif -%}

              {%- if section.settings.show_date -%}
                <time class="ooo-instagram-media__date" data-instagram-field="timestamp"></time>
              {%- endif -%}
            {%- endcapture -%}

            {%- if overlay_content != blank -%}
              <div class="ooo-instagram-media__overlay">
                {{- overlay_content -}}
              </div>
            {%- endif -%}
          {%- endcapture -%}

          {%- if section.settings.click_action == 'open_instagram' -%}
            <a href="#" class="ooo-instagram-media" target="_blank" data-instagram-field="permalink">
              {{- instagram_media_content -}}
            </a>
          {%- else -%}
            <div class="ooo-instagram-media">
              {{- instagram_media_content -}}
            </div>
          {%- endif -%}
        </template>

        {%- comment -%}To allocate the space, we show some placeholders. We automatically pick up a specific number of images based on the settings{%- endcomment -%}

        {%- for i in (1..image_count) -%}
          <div data-media-placeholder class="ooo-instagram-media">
            <img class="ooo-instagram-media__image" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=" alt="">
          </div>
        {%- endfor -%}
      </div>
    </div>

    {%- if section.settings.button_text != blank -%}
      <div class="ooo-instagram-footer">
        <a class="ooo-instagram-footer__button" href="{{ section.settings.button_link }}" target="_blank">{{ section.settings.button_text }}</a>
      </div>
    {%- endif -%}
  </div>

  {%- comment -%}
  We provide a base styles. Then, our JS will inject automatically, based on the theme we detect, extra styles to match the look&feel of the theme.
  {%- endcomment -%}

  <style>
    /*
     Our JS have some detection for most popular themes from the theme store, and will replace CSS classes for things
     like heading and buttons. In addition, we expose some CSS variables that may be overwritten in JS to provide an
     even closer integration with each theme
     */

    /* Due to the fact that our app relies on CSS variables, we hide the section on IE11 and below */
    @media screen and (-ms-high-contrast: active), (-ms-high-contrast: none) {
      #shopify-section-{{ section.id }} {
        display: none !important;
      }
    }

    [data-section-id="{{ section.id }}"] {
      --ooo-instagram-section-vertical-margin: 50px;
      --ooo-instagram-section-vertical-padding: 0;
      --ooo-instagram-container-max-width: {% if section.settings.full_width %}none{% else %}1480px{% endif %};
      --ooo-instagram-external-gutter: 20px;
      --ooo-instagram-header-margin-bottom: 10px;
      --ooo-instagram-header-text-alignment: center;
      --ooo-instagram-grid-gutter: 20px;
      --ooo-instagram-footer-margin-top: 20px;
    }

    @media screen and (min-width: 768px) {
      [data-section-id="{{ section.id }}"] {
        --ooo-instagram-section-vertical-margin: 60px;
        --ooo-instagram-external-gutter: 40px;
      }
    }

    /* Section and container */
    [data-section-id="{{ section.id }}"] {
      margin: var(--ooo-instagram-section-vertical-margin) 0;
      padding: var(--ooo-instagram-section-vertical-padding) 0;
    }

    [data-section-id="{{ section.id }}"] * {
      box-sizing: border-box; /* Some theme do not use this by default */
    }

    {%- unless section.settings.full_width -%}
      [data-section-id="{{ section.id }}"] .ooo-instagram-container {
        max-width: var(--ooo-instagram-container-max-width);
        padding: 0 var(--ooo-instagram-external-gutter);
        margin-left: auto;
        margin-right: auto;
      }
    {%- endunless -%}

    /* Header */
    [data-section-id="{{ section.id }}"] .ooo-instagram-header {
      margin-bottom: var(--ooo-instagram-header-margin-bottom);
      padding: {% if section.settings.full_width %}0 var(--ooo-instagram-external-gutter){% else %}0{% endif %};
      text-align: var(--ooo-instagram-header-text-alignment);
    }

    [data-section-id="{{ section.id }}"] .ooo-instagram-header__title {
      color: {{ section.settings.heading_color }};
    }

    [data-section-id="{{ section.id }}"] .ooo-instagram-header__subheading {
      color: {{ section.settings.subheading_color }};
    }

    [data-section-id="{{ section.id }}"] .ooo-instagram-header__subheading a {
      text-decoration: underline;
      text-underline-position: under;
    }

    [data-section-id="{{ section.id }}"] .ooo-instagram-feed {
      clear: both; /* We do this because some themes float the header and footer */
    }

    /* Feed (on mobile, we always show as scrollable list) */
    [data-section-id="{{ section.id }}"] .ooo-instagram-feed__list {
      padding: var(--ooo-instagram-grid-gutter) {% if section.settings.add_spacing %}var(--ooo-instagram-external-gutter){% else %}0{% endif %};
      white-space: nowrap;
      overflow-x: auto;
      overflow-y: hidden;
      -webkit-overflow-scrolling: touch;
      scroll-snap-type: x mandatory;

      {%- if section.settings.full_width == false -%}
        margin: 0 calc(-1 * var(--ooo-instagram-external-gutter));
      {%- endif -%}
    }

    [data-section-id="{{ section.id }}"] .ooo-instagram-feed__list::-webkit-scrollbar {
      display: none;
    }

    [data-section-id="{{ section.id }}"] .ooo-instagram-media {
      position: relative;
      display: inline-block;
      overflow: hidden;
      width: 75%;
      vertical-align: top;
      white-space: normal;
      scroll-snap-align: center;

      {%- if section.settings.add_spacing -%}
        margin: 0 calc(var(--ooo-instagram-grid-gutter) / 2);
      {%- endif -%}
    }

    [data-section-id="{{ section.id }}"] .ooo-instagram-media:first-child {
      margin-left: 0;
    }

    [data-section-id="{{ section.id }}"] .ooo-instagram-media:last-child {
      margin-right: 0;
    }

    [data-section-id="{{ section.id }}"] .ooo-instagram-media::before {
      content: '';
      display: block;
      padding-bottom: 100%; /* Force the image to be squared */
    }

    [data-section-id="{{ section.id }}"] .ooo-instagram-media__image {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
    }

    @media screen and (min-width: 450px) {
      [data-section-id="{{ section.id }}"] .ooo-instagram-media {
        width: 60%;
      }
    }

    @media screen and (min-width: 600px) {
      [data-section-id="{{ section.id }}"] .ooo-instagram-media {
        width: 50%;
      }
    }

    @media screen and (min-width: 750px) {
      [data-section-id="{{ section.id }}"] .ooo-instagram-media {
        width: 40%;
      }
    }

    @media screen and (min-width: 900px) {
      [data-section-id="{{ section.id }}"] .ooo-instagram-media {
        width: 32%;
      }
    }

    {%- if section.settings.layout == 'sliding_carousel' -%}
      @media screen and (max-width: 999px) {
        [data-section-id="{{ section.id }}"] .ooo-instagram-media:nth-child(15) {
          margin-right: 0;
        }

        [data-section-id="{{ section.id }}"] .ooo-instagram-media:nth-child(15) ~ .ooo-instagram-media {
          display: none;
        }
      }
    {%- endif -%}

    @media screen and (min-width: 1000px) {
      [data-section-id="{{ section.id }}"] .ooo-instagram-feed__list {
        margin: 0;
        padding: var(--ooo-instagram-grid-gutter) {% unless section.settings.add_spacing and section.settings.full_width %}0{% endunless %};

        {%- if section.settings.add_spacing and section.settings.layout != 'sliding_carousel' -%}
          grid-gap: var(--ooo-instagram-grid-gutter);
          gap: var(--ooo-instagram-grid-gutter);
        {%- endif -%}
      }

      [data-section-id="{{ section.id }}"] .ooo-instagram-media {
        display: block;
        width: auto;
        margin: 0;
      }

      {%- if section.settings.layout == 'grid' -%}
        [data-section-id="{{ section.id }}"] .ooo-instagram-feed__list {
          display: grid;
          grid-template-columns: repeat({{ image_count | divided_by: section.settings.rows_count }}, 1fr);
        }
      {%- elsif section.settings.layout == 'collage' -%}
        [data-section-id="{{ section.id }}"] .ooo-instagram-feed__list {
          display: grid;
          grid-template-columns: repeat({% if section.settings.image_size == 'small' %}6{% elsif section.settings.image_size == 'medium' %}5{% else %}4{% endif %}, 1fr);
        }

        [data-section-id="{{ section.id }}"] .ooo-instagram-media:nth-child(5) {
          grid-column: 3 / span 2;
          grid-row: 1 / span 2;
        }
      {%- elsif section.settings.layout == 'sliding_carousel' -%}
        {%- if section.settings.image_size == 'small' -%}
          {%- assign image_percent_width = '16%' -%}
        {%- elsif section.settings.image_size == 'medium' -%}
          {%- assign image_percent_width = '24%' -%}
        {%- else -%}
          {%- assign image_percent_width = '30%' -%}
        {%- endif -%}

        @keyframes ooo-instagram-sliding-carousel {
          0% {
            transform: translateX(0);
          }
          100% {
            {%- if section.settings.add_spacing -%}
              transform: translateX(calc(-1 * (({{ image_percent_width }} * 15) + (var(--ooo-instagram-grid-gutter) * 15))));
            {%- else -%}
              transform: translateX(calc(-1 * ({{ image_percent_width }} * 15)));
            {%- endif -%}
          }
        }

        [data-section-id="{{ section.id }}"] .ooo-instagram-feed {
          overflow: hidden;
        }

        [data-section-id="{{ section.id }}"] .ooo-instagram-feed__list {
          display: flex;
          flex-wrap: nowrap;
          padding: var(--ooo-instagram-grid-gutter) 0;
          animation: ooo-instagram-sliding-carousel 34s linear infinite;
          overflow: visible;
        }

        [data-section-id="{{ section.id }}"] .ooo-instagram-feed__list:hover {
          animation-play-state: paused;
        }

        [data-section-id="{{ section.id }}"] .ooo-instagram-media {
          width: {{ image_percent_width }};
          min-width: {{ image_percent_width }};

          {%- if section.settings.add_spacing -%}
            margin: 0 calc(var(--ooo-instagram-grid-gutter) / 2);
          {%- endif -%}
        }
      {%- endif -%}
    }

    /* Overlay */

    [data-section-id="{{ section.id }}"] .ooo-instagram-media__overlay {
      {%- assign overlay_opacity = section.settings.overlay_opacity | divided_by: 100.0 -%}

      position: absolute;
      display: flex;
      flex-direction: column;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      padding: 14px 20px;
      font-size: 0.9em;
      background: {{ section.settings.overlay_color | color_modify: 'alpha', overlay_opacity }};
      color: {{ section.settings.overlay_text_color }};
      opacity: 0;
      transition: opacity 0.2s ease-in-out;
    }

    @media (hover: hover) {
      [data-section-id="{{ section.id }}"] .ooo-instagram-media:hover .ooo-instagram-media__overlay {
        opacity: 1;
      }
    }

    [data-section-id="{{ section.id }}"] .ooo-instagram-media__author-container {
      display: flex;
      align-items: center;
      flex-shrink: 0;
      margin-bottom: 16px;
    }

    [data-section-id="{{ section.id }}"] .ooo-instagram-media__author-icon {
      margin-right: 8px;
    }

    [data-section-id="{{ section.id }}"] .ooo-instagram-media__caption {
      display: -webkit-box;
      -webkit-box-orient: vertical;
      -webkit-line-clamp: 3;
      overflow: hidden;
    }

    [data-section-id="{{ section.id }}"] .ooo-instagram-media__caption:first-child {
      margin-top: 0;
    }

    [data-section-id="{{ section.id }}"] .ooo-instagram-media__date {
      margin-top: auto;
      text-transform: uppercase;
      font-size: 0.9em;
      font-weight: 500;
      letter-spacing: 0.1em;
    }

    /* Footer */
    [data-section-id="{{ section.id }}"] .ooo-instagram-footer {
      margin-top: var(--ooo-instagram-footer-margin-top);
      padding: 0 var(--ooo-instagram-external-gutter);
      text-align: center;
    }

    [data-section-id="{{ section.id }}"] .ooo-instagram-footer__button {
      display: inline-block;
      color: {{ section.settings.button_color }};
      background: {{ section.settings.button_background }};
      padding: 6px 24px;
      text-decoration: none;
    }
  </style>
</section>

{% schema %}
{
  "name": {
    "en": "Instagram feed",
    "fr": "Flux Instagram",
    "ja": "Instagramフィード"
  },
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": {
        "en": "Heading",
        "fr": "Titre",
        "ja": "見出し"
      },
      "default": {
        "en": "Instagram feed",
        "fr": "Flux Instagram",
        "ja": "Instagramフィード"
      }
    },
    {
      "type": "richtext",
      "id": "subheading",
      "label": {
        "en": "Subheading",
        "fr": "Sous-titre",
        "ja": "小見出し"
      },
      "default": {
        "en": "<p>Write content about your brand</p>",
        "fr": "<p>Parlez de votre marque</p>",
        "ja": "<p>ブランドのタグライン</p>"
      }
    },
    {
      "type": "text",
      "id": "button_text",
      "label": {
        "en": "Button text",
        "fr": "Texte du bouton",
        "ja": "ボタンテキスト"
      }
    },
    {
      "type": "url",
      "id": "button_link",
      "label": {
        "en": "Button link",
        "fr": "Lien du bouton",
        "ja": "ボタンリンク"
      }
    },
    {
      "type": "header",
      "content": {
        "en": "Appearance",
        "fr": "Apparence",
        "ja": "表示"
      },
      "info": {
        "en": "On mobile and tablet, the feed displays as a scrollable grid.",
        "fr": "Sur téléphone et tablette, le flux s'affiche sous forme d'une grille scrollable.",
        "ja": "スマホとタブレットでは、フィードはスクロールできるグリッドとなります。"
      }
    },
    {
      "type": "select",
      "id": "layout",
      "label": {
        "en": "Layout",
        "fr": "Disposition",
        "ja": "レイアウト"
      },
      "options": [
        {
          "value": "grid",
          "label": {
            "en": "Grid",
            "fr": "Grille",
            "ja": "グリッド"
          }
        },
        {
          "value": "collage",
          "label": {
            "en": "Collage",
            "fr": "Collage",
            "ja": "コラージュ"
          }
        },
        {
          "value": "sliding_carousel",
          "label": {
            "en": "Sliding carousel",
            "fr": "Carousel défilant",
            "ja": "スライド型カルーセル"
          }
        }
      ],
      "default": "grid"
    },
    {
      "type": "select",
      "id": "image_size",
      "label": {
        "en": "Image size",
        "fr": "Taille des images",
        "ja": "画像サイズ"
      },
      "options": [
        {
          "value": "small",
          "label": {
            "en": "Small",
            "fr": "Petite",
            "ja": "小"
          }
        },
        {
          "value": "medium",
          "label": {
            "en": "Medium",
            "fr": "Moyenne",
            "ja": "中"
          }
        },
        {
          "value": "large",
          "label": {
            "en": "Large",
            "fr": "Grande",
            "ja": "大"
          }
        }
      ],
      "default": "small"
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "label": {
        "en": "Show full-width",
        "fr": "Afficher sur toute la largeur",
        "ja": "フル画面幅で表示させる"
      },
      "default": false
    },
    {
      "type": "checkbox",
      "id": "add_spacing",
      "label": {
        "en": "Add spacing between images",
        "fr": "Espacer les images",
        "ja": "画像の間にスペースをいれる"
      },
      "default": true
    },
    {
      "type": "range",
      "min": 1,
      "max": 3,
      "step": 1,
      "id": "rows_count",
      "label": {
        "en": "Rows count",
        "fr": "Nombre de lignes",
        "ja": "列数"
      },
      "info": {
        "en": "Only affects grid layout.",
        "fr": "S'applique uniquement à la disposition en grille.",
        "ja": "グリッドレイアウトにのみ適用"
      },
      "default": 2
    },
    {
      "type": "header",
      "content": {
        "en": "Overlay",
        "fr": "Overlay",
        "ja": "オーバーレイ"
      },
      "info": {
        "en": "Overlay does not show up on touch devices (such as mobile and tablet).",
        "fr": "L'overlay ne s'affiche pas sur les appareils tactiles (tels que les téléphones et tablettes).",
        "ja": "オーバーレイは、スマホやタブレットでは表示されません。"
      }
    },
    {
      "type": "checkbox",
      "id": "show_author",
      "label": {
        "en": "Show author",
        "fr": "Afficher l'auteur",
        "ja": "ユーザー名を表示"
      },
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_caption",
      "label": {
        "en": "Show caption",
        "fr": "Afficher la description",
        "ja": "キャプションを表示"
      },
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_date",
      "label": {
        "en": "Show date",
        "fr": "Afficher la date",
        "ja": "投稿の日付を表示"
      },
      "default": true
    },
    {
      "type": "select",
      "id": "click_action",
      "label": {
        "en": "On image click",
        "fr": "Au clic sur l'image",
        "ja": "画像をクリックした際の挙動"
      },
      "options": [
        {
          "value": "open_instagram",
          "label": {
            "en": "Open Instagram",
            "fr": "Ouvrir Instagram",
            "ja": "Instagramの投稿ページを開く"
          }
        },
        {
          "value": "do_nothing",
          "label": {
            "en": "Do nothing",
            "fr": "Ne rien faire",
            "ja": "何もしない"
          }
        }
      ],
      "default": "open_instagram"
    },
    {
      "type": "header",
      "content": {
        "en": "Colors",
        "fr": "Couleurs",
        "ja": "カラー"
      },
      "info": {
        "en": "Pre-integrated themes, when selected, will automatically use your chosen color settings. [Learn more](https://apps.helpscoutdocs.com/article/249-how-section-feed-integrate-with-my-theme)",
        "fr": "Les thèmes pré-intégrés à l'application ré-utilisent automatiquement vos réglages favoris de couleur. [En savoir plus](https://apps.helpscoutdocs.com/article/249-how-section-feed-integrate-with-my-theme)",
        "ja": "本アプリと既にインテグレーションされているShopifyテーマの場合は、既に設定してあるカラー設定を引継ぎます。[サポート](https://apps.helpscoutdocs.com/article/249-how-section-feed-integrate-with-my-theme)"
      }
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": {
        "en": "Heading",
        "fr": "Titre",
        "ja": "見出し"
      },
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "subheading_color",
      "label": {
        "en": "Subheading",
        "fr": "Sous-titre",
        "ja": "小見出し"
      },
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_background",
      "label": {
        "en": "Button background",
        "fr": "Arrière-plan du bouton",
        "ja": "ボタン背景"
      },
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_color",
      "label": {
        "en": "Button text",
        "fr": "Texte du bouton",
        "ja": "ボタンテキスト"
      },
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "overlay_color",
      "label": {
        "en": "Overlay",
        "fr": "Overlay",
        "ja": "オーバーレイ"
      },
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "overlay_text_color",
      "label": {
        "en": "Overlay text",
        "fr": "Text de l'overlay",
        "ja": "オーバーレイのテキスト"
      },
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "%",
      "label": {
        "en": "Overlay opacity",
        "fr": "Opacité de l'overlay",
        "ja": "オーバーレイの不透明度"
      },
      "default": 65
    }
  ],
  "presets": [
    {
      "category": {
        "en": "Section Feed",
        "fr": "Section Feed",
        "ja": "Section Feed"
      },
      "name": {
        "en": "Instagram feed",
        "fr": "Flux Instagram",
        "ja": "Instagramフィード"
      },
      "settings": {}
    }
  ]
}
{% endschema %}